[tasks.format]
description = "Format code with Ruff"
run = "ruff format ."

[tasks.lint]
description = "Lint sources with Ruff"
run = "ruff check src/aiofreqlimit tests"

[tasks.mypy]
description = "Type-check with mypy --strict"
run = "uv run mypy --strict ."

[tasks.basedpyright]
description = "Type-check with basedpyright"
run = "basedpyright"

[tasks.coverage]
description = "Run pytest with coverage reports"
env = { COVERAGE_FILE = ".coverage/.coverage" }
run = """
uv run pytest --cov=src/aiofreqlimit --cov-report term --cov-report html:.coverage tests
"""

[tasks.test]
description = "Run unit tests"
run = "uv run pytest tests"

[tasks.all]
description = "Format, lint, type-check, and test"
depends = ["format", "lint", "mypy", "basedpyright", "test"]
run = "true"

[tasks.build]
description = "Build sdist and wheel artifacts"
run = """
if [ -d dist ]; then rm -rf dist; fi
python -m build
rm -rf *.egg-info
"""

[tasks.upload]
description = "Upload packaged artifacts to PyPI via twine"
run = """
twine upload dist/*
rm -rf dist
"""
